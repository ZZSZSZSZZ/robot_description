<?xml version="1.0" encoding="utf-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="robot_hand">

  <xacro:include filename="$(find robot_description)/urdf/hand/robot_hand_macro.xacro" />

  <xacro:macro name="robot_hand"
    params="arm_direction:='' hand_connected_to:='' hand_limits hand_inertials hand_kinematics hand_kinematics_link">

    <!-- 前缀定义 -->
    <xacro:property name="hand_prefix" default="hand_${arm_direction}_" />

    <!-- hand_link -->
    <xacro:hand_link_with_sc name="hand" hand_kinematics_link="${hand_kinematics_link}"
      hand_inertials="${hand_inertials}" />

    <joint name="${hand_prefix}hand_joint" type="fixed">
      <parent link="${hand_connected_to}" />
      <child link="${hand_prefix}hand" />
      <origin xyz="0 0 0" rpy="0 0 0" />
    </joint>

    <!-- 左手指 -->
    <link name="${hand_prefix}left_finger">
      <visual name="${hand_prefix}left_finger_visual">
        <xacro:hand_kinematics_link name="${arm_direction}_left_finger"
          config="${hand_kinematics_link}" />
        <geometry>
          <mesh
            filename="package://robot_description/meshes/hand/visual/${arm_direction}_left_finger.STL" />
          <!-- <mesh filename="package://robot_description/meshes/hand/visual/finger.dae"/> -->
        </geometry>
        <material name="White">
          <color rgba="1.0 1.0 1.0 1.0" />
        </material>
      </visual>
      <collision name="${hand_prefix}left_finger_collision">
        <xacro:hand_kinematics_link name="${arm_direction}_left_finger"
          config="${hand_kinematics_link}" />
        <geometry>
          <mesh
            filename="package://robot_description/meshes/hand/visual/${arm_direction}_left_finger.STL" />
          <!-- <mesh filename="package://robot_description/meshes/hand/collision/finger.stl"/> -->
        </geometry>
      </collision>
      <xacro:hand_inertials name="${arm_direction}_left_finger" config="${hand_inertials}" />
    </link>

    <!-- 右手指 -->
    <link name="${hand_prefix}right_finger">
      <visual name="${hand_prefix}right_finger_visual">
        <xacro:hand_kinematics_link name="${arm_direction}_right_finger"
          config="${hand_kinematics_link}" />
        <geometry>
          <mesh
            filename="package://robot_description/meshes/hand/visual/${arm_direction}_right_finger.STL" />
        </geometry>
        <material name="White">
          <color rgba="1.0 1.0 1.0 1.0" />
        </material>
      </visual>
      <collision name="${hand_prefix}right_finger_collision">
        <xacro:hand_kinematics_link name="${arm_direction}_right_finger"
          config="${hand_kinematics_link}" />
        <geometry>
          <mesh
            filename="package://robot_description/meshes/hand/visual/${arm_direction}_right_finger.STL" />
        </geometry>
      </collision>
      <xacro:hand_inertials name="${arm_direction}_right_finger" config="${hand_inertials}" />
    </link>

    <!-- 左手指 -->
    <joint name="${hand_prefix}left_finger_joint" type="revolute">
      <xacro:hand_kinematics name="${arm_direction}_left_finger" config="${hand_kinematics}" />
      <parent link="${hand_prefix}hand" />
      <child link="${hand_prefix}left_finger" />
      <axis xyz="0 0 -1" />
      <xacro:hand_limits name="${arm_direction}_left_finger" config="${hand_limits}" />
      <mimic joint="${hand_prefix}right_finger_joint" multiplier="-1"/>
    </joint>

    <!-- 右手指 -->
    <joint name="${hand_prefix}right_finger_joint" type="revolute">
      <xacro:hand_kinematics name="${arm_direction}_right_finger" config="${hand_kinematics}" />
      <parent link="${hand_prefix}hand" />
      <child link="${hand_prefix}right_finger" />
      <axis xyz="0 0 -1" />
      <xacro:hand_limits name="${arm_direction}_right_finger" config="${hand_limits}" />
    </joint>

  </xacro:macro>
</robot>